<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Carrito de Compras - CosmeParador</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <!-- HEADER -->
    <header class="header">
      <div class="container">
        <nav class="navbar">
          <a href="index.html" class="navbar-brand">
            <span style="font-size: 2rem">üçï</span>
            <span>CosmeParador</span>
          </a>
          <ul class="navbar-menu">
            <li><a href="menu.html" class="navbar-link">Men√∫</a></li>
            <li>
              <a href="promociones.html" class="navbar-link">Promociones</a>
            </li>
            <li><a href="index.html" class="navbar-link">Inicio</a></li>
          </ul>
          <div class="theme-toggle">
            <input type="checkbox" id="theme-switch" />
            <label for="theme-switch"></label>
          </div>
        </nav>
      </div>
    </header>

    <!-- MAIN CONTENT -->
    <main style="padding: 2rem 0; min-height: 60vh">
      <div class="container">
        <h1 style="margin-bottom: 2rem">üõí Tu Carrito</h1>

        <div class="grid grid-cols-3" style="align-items: start">
          <!-- CART ITEMS -->
          <div style="grid-column: span 2">
            <div id="cartItems">
              <!-- Items cargados din√°micamente -->
            </div>

            <!-- Empty Cart Message -->
            <div
              id="emptyCart"
              style="display: none; text-align: center; padding: 4rem 2rem"
            >
              <div style="font-size: 5rem; margin-bottom: 1rem">üõí</div>
              <h3>Tu carrito est√° vac√≠o</h3>
              <p style="color: var(--text-secondary); margin-bottom: 2rem">
                ¬°Agrega algunos productos deliciosos!
              </p>
              <a href="menu.html" class="btn btn-primary btn-lg"
                >Explorar Men√∫</a
              >
            </div>
          </div>

          <!-- ORDER SUMMARY -->
          <div class="card" style="position: sticky; top: 80px">
            <div class="card-body">
              <h3 style="margin-bottom: 1.5rem">Resumen del pedido</h3>

              <div style="margin-bottom: 1rem">
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 0.5rem;
                  "
                >
                  <span>Subtotal:</span>
                  <span id="subtotal">$0</span>
                </div>
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 0.5rem;
                  "
                >
                  <span>Env√≠o:</span>
                  <span id="shipping">$5,000</span>
                </div>
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 0.5rem;
                    color: var(--success);
                  "
                >
                  <span>Descuento:</span>
                  <span id="discount">-$0</span>
                </div>
              </div>

              <div
                style="
                  border-top: 2px solid var(--border-color);
                  padding-top: 1rem;
                  margin-bottom: 1.5rem;
                "
              >
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    font-size: 1.25rem;
                    font-weight: bold;
                  "
                >
                  <span>Total:</span>
                  <span id="total" style="color: var(--primary)">$0</span>
                </div>
              </div>

              <!-- Coupon -->
              <div class="form-group">
                <label class="form-label">¬øTienes un cup√≥n?</label>
                <div style="display: flex; gap: 0.5rem">
                  <input
                    type="text"
                    class="form-control"
                    id="couponInput"
                    placeholder="C√≥digo"
                  />
                  <button class="btn btn-secondary" onclick="applyCoupon()">
                    Aplicar
                  </button>
                </div>
                <p
                  id="couponMessage"
                  style="margin-top: 0.5rem; font-size: 0.875rem"
                ></p>
              </div>

              <!-- Checkout Button -->
              <button
                class="btn btn-primary"
                style="width: 100%"
                onclick="goToCheckout()"
                id="checkoutBtn"
                disabled
              >
                Proceder al pago
              </button>

              <div style="text-align: center; margin-top: 1rem">
                <a href="menu.html" style="font-size: 0.875rem"
                  >‚Üê Seguir comprando</a
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- FOOTER -->
    <footer style="background: var(--bg-tertiary); padding: 2rem 0">
      <div class="container text-center">
        <p>&copy; 2026 CosmeParador. Todos los derechos reservados.</p>
      </div>
    </footer>

    <script src="app.js"></script>
    <script>
      // Renderizar carrito
      function renderCart() {
        const cartItems = document.getElementById("cartItems");
        const emptyCart = document.getElementById("emptyCart");
        const checkoutBtn = document.getElementById("checkoutBtn");

        if (cart.getItemCount() === 0) {
          cartItems.style.display = "none";
          emptyCart.style.display = "block";
          checkoutBtn.disabled = true;
          return;
        }

        cartItems.style.display = "block";
        emptyCart.style.display = "none";
        checkoutBtn.disabled = false;

        cartItems.innerHTML = AppState.cart
          .map(
            (item) => `
                <div class="card" style="margin-bottom: 1rem;">
                    <div class="card-body">
                        <div style="display: flex; gap: 1rem;">
                            <img src="${item.image}" alt="${item.name}" 
                                style="width: 100px; height: 100px; object-fit: cover; border-radius: var(--border-radius-md);">
                            
                            <div style="flex: 1;">
                                <h4 style="margin-bottom: 0.5rem;">${
                                  item.name
                                }</h4>
                                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">
                                    ${item.description}
                                </p>
                                
                                ${
                                  item.customizations &&
                                  Object.keys(item.customizations).length > 0
                                    ? `
                                    <div style="font-size: 0.875rem; color: var(--text-muted);">
                                        Personalizaci√≥n: ${JSON.stringify(
                                          item.customizations
                                        )}
                                    </div>
                                `
                                    : ""
                                }
                                
                                <div style="display: flex; align-items: center; gap: 1rem; margin-top: 1rem;">
                                    <!-- Quantity Controls -->
                                    <div style="display: flex; align-items: center; gap: 0.5rem; border: 2px solid var(--border-color); border-radius: var(--border-radius-md); padding: 0.25rem;">
                                        <button class="btn btn-ghost btn-sm" onclick="updateCartQuantity(${
                                          item.cartId
                                        }, ${item.quantity - 1})" 
                                            style="min-width: 32px; padding: 0.25rem;">-</button>
                                        <span style="min-width: 30px; text-align: center; font-weight: 600;">${
                                          item.quantity
                                        }</span>
                                        <button class="btn btn-ghost btn-sm" onclick="updateCartQuantity(${
                                          item.cartId
                                        }, ${item.quantity + 1})" 
                                            style="min-width: 32px; padding: 0.25rem;">+</button>
                                    </div>
                                    
                                    <div style="flex: 1; text-align: right;">
                                        <div style="font-size: var(--font-size-xl); font-weight: bold; color: var(--primary);">
                                            ${formatCurrency(
                                              item.price * item.quantity
                                            )}
                                        </div>
                                        <div style="font-size: 0.875rem; color: var(--text-muted);">
                                            ${formatCurrency(item.price)} c/u
                                        </div>
                                    </div>
                                    
                                    <button class="btn btn-ghost btn-sm" onclick="removeFromCart(${
                                      item.cartId
                                    })" 
                                        style="color: var(--danger);">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `
          )
          .join("");

        updateSummary();
      }

      function updateCartQuantity(cartId, newQuantity) {
        if (newQuantity < 1) {
          removeFromCart(cartId);
          return;
        }
        cart.updateQuantity(cartId, newQuantity);
        renderCart();
      }

      function removeFromCart(cartId) {
        if (confirm("¬øEliminar este producto del carrito?")) {
          cart.removeItem(cartId);
          renderCart();
        }
      }

      function updateSummary() {
        const subtotal = cart.getTotal();
        const shipping = subtotal > 50000 ? 0 : 5000;
        const discount = window.appliedDiscount || 0;
        const total = subtotal + shipping - discount;

        document.getElementById("subtotal").textContent =
          formatCurrency(subtotal);
        document.getElementById("shipping").textContent =
          shipping === 0 ? "GRATIS" : formatCurrency(shipping);
        document.getElementById("discount").textContent =
          discount > 0 ? "-" + formatCurrency(discount) : "$0";
        document.getElementById("total").textContent = formatCurrency(total);

        if (subtotal > 0 && subtotal < 15000) {
          showToast(
            `Te faltan ${formatCurrency(
              15000 - subtotal
            )} para el pedido m√≠nimo`,
            "info"
          );
        }

        if (subtotal >= 45000 && subtotal < 50000) {
          showToast(
            `¬°Solo ${formatCurrency(50000 - subtotal)} m√°s para env√≠o gratis!`,
            "info"
          );
        }
      }

      function applyCoupon() {
        const code = document.getElementById("couponInput").value.trim();
        const message = document.getElementById("couponMessage");

        if (!code) {
          message.style.color = "var(--danger)";
          message.textContent = "Ingresa un c√≥digo";
          return;
        }

        // Simulaci√≥n de validaci√≥n
        if (code.toUpperCase() === "BIENVENIDO15") {
          const discount = Math.floor(cart.getTotal() * 0.15);
          window.appliedDiscount = discount;
          message.style.color = "var(--success)";
          message.textContent = `‚úÖ Cup√≥n aplicado: -${formatCurrency(
            discount
          )}`;
          updateSummary();
          showToast("¬°Cup√≥n aplicado exitosamente!");
        } else {
          message.style.color = "var(--danger)";
          message.textContent = "‚ùå Cup√≥n inv√°lido";
        }
      }

      function goToCheckout() {
        if (cart.getItemCount() === 0) return;

        const total = cart.getTotal();
        if (total < 15000) {
          showToast("El pedido m√≠nimo es de $15,000", "error");
          return;
        }

        window.location.href = "checkout.html";
      }

      // Inicializar
      document.addEventListener("DOMContentLoaded", () => {
        renderCart();
      });
    </script>
  </body>
</html>
